# プロトタイプ実装 - 要件定義

## 作業概要
ヴァンサバライクブラウザゲームのプロトタイプ（Phase 1）を実装する。最小限の機能でコアゲームループを動作させ、ゲーム性を検証する。

## 実装する機能

### 1. プロジェクトセットアップ
- **環境構築**
  - Node.js プロジェクト初期化
  - TypeScript + Vite のセットアップ
  - 基本的なディレクトリ構造の作成
  - 開発用設定ファイルの配置

- **必要なパッケージ**
  - TypeScript
  - Vite
  - ESLint
  - Prettier

### 2. コアエンジン実装
- **Game クラス**
  - ゲームループの実装
  - requestAnimationFrame による更新
  - deltaTime の計算
  - 60FPS ターゲット

- **Renderer クラス**
  - Canvas 2D Context の管理
  - 基本図形描画（矩形、円）
  - テキスト描画
  - 画面クリア

- **InputManager クラス**
  - キーボード入力の検出
  - WASD/矢印キー対応
  - 移動方向の計算

- **SceneManager クラス**
  - シーン切り替え機能
  - シーンのライフサイクル管理

### 3. エンティティ実装

#### プレイヤー
- **基本プロパティ**
  - 位置（x, y）
  - HP: 100
  - 最大HP: 100
  - レベル: 1
  - 経験値: 0
  - 移動速度: 200px/s
  - 衝突半径: 20px

- **機能**
  - 8方向移動
  - ダメージ処理
  - 経験値獲得
  - レベルアップ
  - 死亡判定

- **描画**
  - 青い円（半径20px）
  - HPバー表示

#### 敵（BasicEnemy）
- **基本プロパティ**
  - 位置（x, y）
  - HP: 10
  - 最大HP: 10
  - 移動速度: 80px/s
  - ダメージ: 5
  - 経験値ドロップ: 1
  - 衝突半径: 15px

- **AI**
  - プレイヤーへ直進
  - 接触でダメージ

- **描画**
  - 赤い円（半径15px）
  - HPバー表示

#### 武器（BasicWeapon）
- **基本プロパティ**
  - ダメージ: 10
  - 攻撃速度: 1.0秒（1秒に1回）
  - 攻撃範囲: 150px
  - 貫通数: 1

- **機能**
  - 自動攻撃（最寄りの敵を攻撃）
  - レベルアップで強化

- **描画**
  - 攻撃時に攻撃エフェクト（線または円）

#### 経験値オーブ
- **基本プロパティ**
  - 位置（x, y）
  - 経験値量: 1
  - 引き寄せ範囲: 100px

- **機能**
  - プレイヤーに近づくと引き寄せ
  - 接触で収集

- **描画**
  - 緑の小さい円（半径5px）

### 4. ゲームシステム実装

#### EntityManager
- エンティティの追加・削除
- エンティティのタイプ別取得
- 全エンティティの更新

#### CollisionSystem
- 円形衝突判定
- プレイヤーと敵の衝突
- プレイヤーと経験値オーブの衝突
- 武器と敵の衝突

#### SpawnSystem
- 敵のスポーン管理
- スポーン間隔: 初期2秒、時間経過で短縮
- スポーン位置: 画面外ランダム
- 最大敵数: 100体

#### LevelSystem
- 経験値管理
- レベルアップ判定
- 必要経験値計算: `10 + (level * 5)`
- 強化選択肢の生成

#### CombatSystem
- ダメージ処理
- 敵の死亡処理
- 経験値オーブのドロップ

### 5. シーン実装

#### TitleScene
- **表示内容**
  - ゲームタイトル
  - 「Click to Start」メッセージ
  - 操作説明（WASD/矢印キー）

- **機能**
  - クリックでゲーム開始

#### GameScene
- **表示内容**
  - ゲームフィールド（1280x720）
  - プレイヤー
  - 敵
  - 武器エフェクト
  - 経験値オーブ
  - HUD

- **機能**
  - ゲームループ実行
  - 制限時間: 10分（600秒）
  - 時間切れで勝利
  - プレイヤー死亡で敗北

#### GameOverScene
- **表示内容**
  - 結果（WIN/LOSE）
  - 生存時間
  - 撃破数
  - リトライボタン
  - タイトルに戻るボタン

- **機能**
  - ボタンクリックでシーン遷移

### 6. UI実装

#### HUD（ヘッドアップディスプレイ）
- **表示要素**
  - HPバー（左上）
  - 現在HP/最大HP テキスト
  - レベル表示
  - 経験値バー
  - 現在経験値/必要経験値 テキスト
  - 経過時間（MM:SS形式）
  - 撃破数

#### LevelUpPanel
- **表示内容**
  - 「LEVEL UP!」テキスト
  - 3つの強化選択肢
    - 各選択肢: タイトル、説明、選択ボタン

- **強化選択肢**
  1. 武器ダメージ +20%
  2. 攻撃速度 +15%
  3. 攻撃範囲 +25%
  4. 武器貫通 +1
  5. 移動速度 +10%
  6. 最大HP +20
  7. HP回復 50%

- **機能**
  - 表示時にゲーム一時停止
  - 選択後に再開

### 7. 設定ファイル実装

#### GameConfig
```typescript
{
  GAME_WIDTH: 1280,
  GAME_HEIGHT: 720,
  TARGET_FPS: 60,
  GAME_DURATION: 600, // 10分
}
```

#### PlayerConfig
```typescript
{
  MAX_HP: 100,
  MOVE_SPEED: 200,
  COLLISION_RADIUS: 20,
  PICKUP_RANGE: 100,
}
```

#### EnemyConfig
```typescript
{
  BASIC_ENEMY: {
    HP: 10,
    MOVE_SPEED: 80,
    DAMAGE: 5,
    EXP_DROP: 1,
    COLLISION_RADIUS: 15,
  }
}
```

#### WeaponConfig
```typescript
{
  BASIC_WEAPON: {
    DAMAGE: 10,
    ATTACK_SPEED: 1.0,
    RANGE: 150,
    PIERCING: 1,
  }
}
```

#### BalanceConfig
```typescript
{
  SPAWN_INTERVAL_START: 2.0,
  SPAWN_INTERVAL_MIN: 0.3,
  MAX_ENEMIES: 100,
  EXP_BASE: 10,
  EXP_MULTIPLIER: 5,
}
```

## 受入基準

### 機能要件
- ✅ プレイヤーがWASD/矢印キーで移動できる
- ✅ 敵が定期的にスポーンし、プレイヤーに向かってくる
- ✅ 武器が自動で最寄りの敵を攻撃する
- ✅ 敵を倒すと経験値オーブがドロップする
- ✅ 経験値オーブを取得すると経験値が増える
- ✅ 経験値が満タンになるとレベルアップする
- ✅ レベルアップ時に強化選択肢が表示される
- ✅ 強化を選択すると能力が向上する
- ✅ 敵と接触するとダメージを受ける
- ✅ HPが0になるとゲームオーバー（敗北）
- ✅ 10分経過するとゲームクリア（勝利）

### パフォーマンス要件
- ✅ 60FPS で安定動作（敵50体程度）
- ✅ 初回ロード3秒以内
- ✅ シーン遷移が瞬時

### UI要件
- ✅ HP、経験値、レベル、時間、撃破数が常に表示される
- ✅ レベルアップパネルが適切に表示・非表示される
- ✅ ゲームオーバー画面で結果が表示される

### コード品質要件
- ✅ TypeScript で型安全に実装
- ✅ 命名規則に従っている
- ✅ 適切にコメントされている
- ✅ エラーハンドリングが実装されている

## 実装しない機能（Phase 2以降）

- 複数キャラクター選択
- 複数武器の同時装備
- 複数ステージ
- サウンド（BGM/効果音）
- 画像スプライト（プレースホルダー図形のみ）
- セーブ/ロード機能
- オンラインランキング
- 実績システム
- 設定画面

## 技術的制約

- Canvas 2D API のみ使用（WebGL不使用）
- 画像アセットは使用せず、図形描画で代用
- サウンドは未実装
- モバイル対応は対象外
- ブラウザのみで動作（サーバー不要）

## 開発環境

- Node.js 18.x以上
- TypeScript 5.x
- Vite 5.x
- モダンブラウザ（Chrome/Firefox/Safari/Edge）

---

**作成日**: 2025-11-28
**対象フェーズ**: Phase 1（プロトタイプ）
**想定期間**: 初期開発
